CREATE OR REPLACE VIEW sessions_interval_log_20190719155839371 FOLDER = '/20190719155839371/sessions/intermediate_views' AS SELECT case WHEN (last_notification_type in ('closeSession', 'logout', 'loginFailure')) THEN last_notification_type ELSE first_notification_type END AS notification_type, last_connection_id AS connection_id, case WHEN (last_notification_type = 'loginFailure') THEN max_date ELSE to_date('yyyy-MM-dd''T''HH:mm:ss.SSS', connection_start_time_as_text) END AS connection_start_time, case WHEN (last_notification_type = 'loginFailure') THEN max_date WHEN (last_connection_end_time_as_text <> '-') THEN to_date('yyyy-MM-dd''T''HH:mm:ss.SSS', last_connection_end_time_as_text) WHEN (first_connection_end_time_as_text <> '-') THEN to_date('yyyy-MM-dd''T''HH:mm:ss.SSS', first_connection_end_time_as_text) ELSE NULL END AS connection_end_time, last_client_ip AS client_ip, last_user_agent AS user_agent, last_access_interface AS access_interface, session_id, case WHEN ((first_notification_type in ('openSession', 'loginOk') OR last_notification_type in ('openSession', 'loginOk'))) THEN min_date WHEN (last_session_start_time_as_text <> '-') THEN to_date('yyyy-MM-dd''T''HH:mm:ss.SSS', last_session_start_time_as_text) ELSE NULL END AS session_start_time, case WHEN ((last_notification_type in ('closeSession', 'logout') OR first_notification_type in ('closeSession', 'logout'))) THEN max_date ELSE NULL END AS session_end_time, last_login AS login, last_database_name AS database_name, last_webservice_name AS webservice_name, last_jms_queue_name AS jms_queue_name, last_intermediate_client_ip AS intermediate_client_ip, case WHEN ((first_notification_type in ('openSession', 'loginOk', 'loginFailure') OR last_notification_type in ('openSession', 'loginOk', 'loginFailure'))) THEN min_date ELSE to_date('yyyy-MM-dd''T''HH:mm:ss.SSS', last_session_start_time_as_text) END AS start_time, case WHEN ((last_notification_type in ('closeSession', 'logout', 'loginFailure') OR first_notification_type in ('closeSession', 'logout', 'loginFailure'))) THEN max_date ELSE NULL END AS end_time FROM (SELECT first(sessions_instant_log_20190719155839371.notification_type) AS first_notification_type, last(sessions_instant_log_20190719155839371.notification_type) AS last_notification_type, last(sessions_instant_log_20190719155839371.connection_id) AS last_connection_id, sessions_instant_log_20190719155839371.connection_start_time_as_text, first(sessions_instant_log_20190719155839371.connection_end_time_as_text) AS first_connection_end_time_as_text, last(sessions_instant_log_20190719155839371.connection_end_time_as_text) AS last_connection_end_time_as_text, last(sessions_instant_log_20190719155839371.client_ip) AS last_client_ip, last(sessions_instant_log_20190719155839371.user_agent) AS last_user_agent, last(sessions_instant_log_20190719155839371.access_interface) AS last_access_interface, sessions_instant_log_20190719155839371.session_id, last(sessions_instant_log_20190719155839371.session_start_time_as_text) AS last_session_start_time_as_text, last(sessions_instant_log_20190719155839371.login) AS last_login, last(sessions_instant_log_20190719155839371.database_name) AS last_database_name, last(sessions_instant_log_20190719155839371.webservice_name) AS last_webservice_name, last(sessions_instant_log_20190719155839371.jms_queue_name) AS last_jms_queue_name, last(sessions_instant_log_20190719155839371.intermediate_client_ip) AS last_intermediate_client_ip, min(sessions_instant_log_20190719155839371.date) AS min_date, max(sessions_instant_log_20190719155839371.date) AS max_date FROM sessions_instant_log_20190719155839371 WHERE cw_search_start_date = to_date('yyyy-MM-dd', '1970-01-01') GROUP BY sessions_instant_log_20190719155839371.session_id, sessions_instant_log_20190719155839371.connection_start_time_as_text) CONTEXT ('I18N' = 'rfc_restful');

